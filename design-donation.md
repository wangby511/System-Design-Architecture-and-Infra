# System Design - Donation Service

CREATED 2022-09-20

## Infra

The donation payment attempt and notification both happens asynchronously.

## Idempotency - Prevent Duplicate Donation

Idempotency key could be uuid generated by clients.

Also it could be hash value of (user + amount + hash(payment method)).

**Be Careful** - Whether the 3rd party payment can handle idempotency?

## Failure Tolerance

### Consistency - Data consistency across different micro-services

What if the [**Payment Attempt Service**] fails to tell [**Donation Service**] that the payment has succeeded? In this case the statuses can be inconsistent.

Also owns a Payment Attempt DB according to [**Payment Attempt Service**]. Using a cron job to determine inconsistency.

Leader node can fail and if that happens, one of the replicas will need to be promoted to be primary. Scenarios like split-brain should be prevented and replication lag should be monitored with metrics.

### Replicas

## Scaling

Split the traffic into multiple nodes.

DB partition - partition by directly userId or hash(userId), a range of hashes like consistent hashing.

## Reference

[1] [Youtube - System design - donation app for a 3 day charity](https://www.youtube.com/watch?v=mNiHK_WK5KM)

[2] [System design for dummies â€” part 3 (Design a donation app)](https://chivagarg.medium.com/system-design-for-dummies-part-3-design-a-donation-app-c9f2720222ce)
